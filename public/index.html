<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExposureEngine | College Soccer Visibility Check</title>
    <meta name="description" content="Get a brutally honest AI-powered analysis of your college soccer recruiting visibility. See exactly how visible you are to D1, D2, D3, NAIA coaches.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0f172a;
            min-height: 100vh;
            color: #e2e8f0;
        }

        .header {
            background: #1e293b;
            border-bottom: 1px solid #334155;
            padding: 1rem 1.5rem;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-icon svg {
            width: 24px;
            height: 24px;
            color: #10b981;
        }

        .logo-text h1 {
            font-size: 1.25rem;
            font-weight: 700;
            color: #f1f5f9;
        }

        .logo-text p {
            font-size: 0.75rem;
            color: #64748b;
        }

        .league-badge {
            display: none;
            padding: 0.25rem 0.75rem;
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 9999px;
            font-size: 0.75rem;
            color: #94a3b8;
        }

        @media (min-width: 640px) {
            .league-badge { display: flex; align-items: center; gap: 0.5rem; }
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .intro {
            text-align: center;
            margin-bottom: 2rem;
        }

        .intro h2 {
            font-size: 1.75rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 0.5rem;
        }

        .intro p {
            color: #94a3b8;
            max-width: 600px;
            margin: 0 auto;
        }

        .form-section {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(51, 65, 85, 0.5);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.25rem;
        }

        .section-number {
            width: 28px;
            height: 28px;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: #10b981;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #10b981;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        @media (max-width: 600px) {
            .form-grid { grid-template-columns: 1fr; }
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            font-size: 0.75rem;
            font-weight: 500;
            color: #94a3b8;
            margin-bottom: 0.375rem;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .form-input, .form-select {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 0.625rem 0.875rem;
            font-size: 0.875rem;
            color: #fff;
            transition: all 0.2s;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2394a3b8'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1rem;
            padding-right: 2.5rem;
        }

        .form-select option {
            background: #1e293b;
        }

        .checkbox-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem;
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .checkbox-row:hover {
            border-color: #10b981;
        }

        .checkbox-row input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #10b981;
        }

        .checkbox-row span {
            font-size: 0.875rem;
            color: #e2e8f0;
        }

        .checkbox-row .hint {
            font-size: 0.75rem;
            color: #64748b;
            margin-top: 0.25rem;
        }

        .season-card, .event-card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            position: relative;
        }

        .remove-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: transparent;
            border: none;
            color: #64748b;
            cursor: pointer;
            padding: 0.25rem;
            transition: color 0.2s;
        }

        .remove-btn:hover {
            color: #ef4444;
        }

        .add-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.625rem 1rem;
            background: transparent;
            border: 1px dashed #334155;
            border-radius: 8px;
            color: #10b981;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            justify-content: center;
        }

        .add-btn:hover {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.05);
        }

        .range-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .range-input {
            width: 100%;
            height: 6px;
            appearance: none;
            background: #334155;
            border-radius: 3px;
            cursor: pointer;
        }

        .range-input::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            background: #10b981;
            border-radius: 50%;
            cursor: pointer;
        }

        .range-value {
            text-align: right;
            font-size: 0.875rem;
            color: #10b981;
            font-family: monospace;
        }

        .submit-btn {
            width: 100%;
            padding: 1rem 2rem;
            background: #10b981;
            border: none;
            border-radius: 12px;
            color: #fff;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .submit-btn:hover:not(:disabled) {
            background: #059669;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.3);
        }

        .submit-btn:disabled {
            background: #334155;
            color: #64748b;
            cursor: not-allowed;
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .results-container {
            display: none;
        }

        .results-container.active {
            display: block;
        }

        .summary-card {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid #334155;
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .summary-card h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 0.75rem;
        }

        .summary-text {
            color: #94a3b8;
            line-height: 1.6;
            border-left: 4px solid #10b981;
            padding-left: 1rem;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 768px) {
            .charts-grid { grid-template-columns: 1fr; }
        }

        .chart-card {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(51, 65, 85, 0.5);
            border-radius: 12px;
            padding: 1.25rem;
        }

        .chart-title {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #64748b;
            margin-bottom: 1rem;
        }

        .chart-container {
            height: 250px;
            position: relative;
        }

        .score-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .score-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.875rem;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid #334155;
            border-radius: 8px;
        }

        .score-badge .level {
            font-size: 0.75rem;
            font-weight: 600;
            color: #fff;
        }

        .score-badge .percent {
            font-size: 0.875rem;
            font-weight: 700;
            color: #10b981;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 768px) {
            .insights-grid { grid-column: 1fr; }
        }

        .insights-card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 1.25rem;
        }

        .insights-card.strengths {
            border-color: rgba(16, 185, 129, 0.3);
        }

        .insights-card.risks {
            border-color: rgba(239, 68, 68, 0.3);
        }

        .insights-card h4 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .insights-card.strengths h4 { color: #10b981; }
        .insights-card.risks h4 { color: #ef4444; }

        .insights-list {
            list-style: none;
        }

        .insights-list li {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: #94a3b8;
            margin-bottom: 0.625rem;
        }

        .insights-list li::before {
            content: 'â€¢';
            color: #10b981;
        }

        .insights-card.risks .insights-list li::before {
            color: #ef4444;
        }

        .risk-severity {
            font-size: 0.625rem;
            padding: 0.125rem 0.375rem;
            border-radius: 4px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .risk-severity.high {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .risk-severity.medium {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        .action-plan {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .action-plan-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 1.25rem;
            background: #0f172a;
            border-bottom: 1px solid #334155;
            font-weight: 600;
            color: #fff;
        }

        .action-item {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 1.25rem;
            border-bottom: 1px solid #334155;
            transition: background 0.2s;
        }

        .action-item:last-child {
            border-bottom: none;
        }

        .action-item:hover {
            background: rgba(51, 65, 85, 0.3);
        }

        .action-timeframe {
            font-size: 0.625rem;
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            text-transform: uppercase;
            flex-shrink: 0;
        }

        .action-timeframe.next-30 {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .action-timeframe.next-90 {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .action-timeframe.next-12 {
            background: rgba(100, 116, 139, 0.2);
            color: #94a3b8;
            border: 1px solid #334155;
        }

        .action-description {
            flex: 1;
            font-size: 0.875rem;
            color: #e2e8f0;
        }

        .action-impact {
            font-size: 0.75rem;
            color: #fbbf24;
            font-weight: 500;
        }

        .reset-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem;
            background: transparent;
            border: none;
            color: #64748b;
            font-size: 0.875rem;
            cursor: pointer;
            transition: color 0.2s;
            margin: 0 auto;
        }

        .reset-btn:hover {
            color: #fff;
        }

        .footer {
            text-align: center;
            padding: 2rem;
            color: #475569;
            font-size: 0.75rem;
        }

        .footer a {
            color: #64748b;
            text-decoration: none;
        }

        .footer a:hover {
            color: #10b981;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            color: #fca5a5;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <circle cx="12" cy="12" r="6"></circle>
                        <circle cx="12" cy="12" r="2"></circle>
                    </svg>
                </div>
                <div class="logo-text">
                    <h1>ExposureEngine</h1>
                    <p>College Recruiting Visibility Check</p>
                </div>
            </div>
            <div class="league-badge">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                </svg>
                MLS NEXT / ECNL / ELITE
            </div>
        </div>
    </header>

    <main class="container">
        <div id="formContainer">
            <div class="intro">
                <h2>Are you actually recruitable?</h2>
                <p>Most players overrate their exposure. Enter your real stats, league level, and outreach to get a brutally honest AI visibility score.</p>
            </div>

            <div id="errorMessage" class="error-message" style="display: none;"></div>

            <form id="evaluationForm">
                <div class="form-section">
                    <div class="section-header">
                        <span class="section-number">1</span>
                        <span class="section-title">The Basics</span>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-input" name="fullName" required data-testid="input-fullName">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" name="email" required data-testid="input-email">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Grad Year</label>
                            <select class="form-select" name="gradYear" required data-testid="select-gradYear">
                                <option value="2025">2025</option>
                                <option value="2026" selected>2026</option>
                                <option value="2027">2027</option>
                                <option value="2028">2028</option>
                                <option value="2029">2029</option>
                                <option value="2030">2030</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Primary Position</label>
                            <select class="form-select" name="position" required data-testid="select-position">
                                <option value="GK">Goalkeeper</option>
                                <option value="CB">Center Back</option>
                                <option value="FB">Full Back</option>
                                <option value="WB">Wing Back</option>
                                <option value="DM">Defensive Mid</option>
                                <option value="CM" selected>Central Mid</option>
                                <option value="AM">Attacking Mid</option>
                                <option value="WING">Winger</option>
                                <option value="9">Striker</option>
                                <option value="Utility">Utility</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Height</label>
                            <input type="text" class="form-input" name="height" placeholder="e.g. 5'10" data-testid="input-height">
                        </div>
                        <div class="form-group">
                            <label class="form-label">State / Region</label>
                            <input type="text" class="form-input" name="stateRegion" placeholder="e.g. SoCal, NJ, TX" required data-testid="input-stateRegion">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-header">
                        <span class="section-number">2</span>
                        <span class="section-title">Academics</span>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">GPA (Unweighted)</label>
                            <input type="number" step="0.01" min="0" max="4.0" class="form-input" name="gpa" placeholder="e.g. 3.5" required data-testid="input-gpa">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Test Score (Optional)</label>
                            <input type="text" class="form-input" name="testScore" placeholder="e.g. 1300 SAT or 28 ACT" data-testid="input-testScore">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-header">
                        <span class="section-number">3</span>
                        <span class="section-title">Season History</span>
                    </div>
                    <div id="seasonsContainer">
                        <div class="season-card" data-season-index="0">
                            <button type="button" class="remove-btn" onclick="removeSeason(0)" style="display: none;" data-testid="btn-remove-season-0">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2"></path></svg>
                            </button>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Year</label>
                                    <input type="number" class="form-input" name="season_year_0" value="2024" data-testid="input-season-year-0">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">League</label>
                                    <select class="form-select" name="season_league_0" data-testid="select-season-league-0">
                                        <option value="MLS_NEXT">MLS NEXT</option>
                                        <option value="ECNL" selected>ECNL</option>
                                        <option value="Girls_Academy">Girls Academy</option>
                                        <option value="ECNL_RL">ECNL RL</option>
                                        <option value="USYS_National_League">USYS National League</option>
                                        <option value="USL_Academy">USL Academy</option>
                                        <option value="High_School">High School</option>
                                        <option value="Elite_Local">Elite Local</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Team Name</label>
                                    <input type="text" class="form-input" name="season_team_0" placeholder="Club Name" data-testid="input-season-team-0">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Role</label>
                                    <select class="form-select" name="season_role_0" data-testid="select-season-role-0">
                                        <option value="Key_Starter" selected>Key Starter</option>
                                        <option value="Rotation">Rotation</option>
                                        <option value="Bench">Bench</option>
                                        <option value="Injured">Injured</option>
                                    </select>
                                </div>
                                <div class="form-group full-width">
                                    <label class="form-label">Minutes Played % (Approx)</label>
                                    <div class="range-container">
                                        <input type="range" class="range-input" name="season_minutes_0" min="0" max="100" step="5" value="80" oninput="updateRangeDisplay(this)" data-testid="range-season-minutes-0">
                                        <span class="range-value" id="minutes_display_0">80%</span>
                                    </div>
                                </div>
                                <div class="form-group full-width">
                                    <label class="form-label">Honors / Notes</label>
                                    <input type="text" class="form-input" name="season_honors_0" placeholder="e.g. Captain, All-Conference" data-testid="input-season-honors-0">
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="add-btn" onclick="addSeason()" data-testid="btn-add-season">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        Add Season
                    </button>
                </div>

                <div class="form-section">
                    <div class="section-header">
                        <span class="section-number">4</span>
                        <span class="section-title">Recruiting Reality</span>
                    </div>
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <div class="checkbox-row" onclick="toggleCheckbox('hasVideoLink')">
                                <input type="checkbox" name="hasVideoLink" id="hasVideoLink" data-testid="checkbox-hasVideoLink">
                                <div>
                                    <span>I have a current Highlight Video (Hudl/YouTube)</span>
                                    <div class="hint">No video usually means zero visibility for schools outside your driving radius.</div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Coaches Emailed</label>
                            <input type="number" class="form-input" name="coachesContacted" value="0" min="0" data-testid="input-coachesContacted">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Personal Replies Received</label>
                            <input type="number" class="form-input" name="responsesReceived" value="0" min="0" data-testid="input-responsesReceived">
                        </div>
                    </div>

                    <div style="margin-top: 1.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                            <label class="form-label" style="margin: 0;">Major Events (Last 12 Months)</label>
                            <button type="button" class="add-btn" style="width: auto; padding: 0.375rem 0.75rem;" onclick="addEvent()" data-testid="btn-add-event">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                Add Event
                            </button>
                        </div>
                        <div id="eventsContainer">
                            <p style="font-size: 0.75rem; color: #64748b; text-align: center; padding: 0.75rem;">No events added. National showcases help visibility scoring.</p>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="checkbox-row" onclick="toggleCheckbox('consentToContact')">
                        <input type="checkbox" name="consentToContact" id="consentToContact" checked data-testid="checkbox-consentToContact">
                        <span>I consent to be contacted by Warubi and its partners about opportunities.</span>
                    </div>
                </div>

                <button type="submit" class="submit-btn" id="submitBtn" data-testid="btn-submit">
                    Calculate Visibility
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"></path></svg>
                </button>
            </form>
        </div>

        <div id="resultsContainer" class="results-container">
            <div class="summary-card">
                <h3>Recruiting Reality Check</h3>
                <p class="summary-text" id="summaryText"></p>
            </div>

            <div class="score-badges" id="scoreBadges"></div>

            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-title">Estimated Visibility by Level</div>
                    <div class="chart-container">
                        <canvas id="visibilityChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Profile Readiness</div>
                    <div class="chart-container">
                        <canvas id="readinessChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="insights-grid">
                <div class="insights-card strengths">
                    <h4>
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                        Key Strengths
                    </h4>
                    <ul class="insights-list" id="strengthsList"></ul>
                </div>
                <div class="insights-card risks">
                    <h4>
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                        Critical Risks
                    </h4>
                    <ul class="insights-list" id="risksList"></ul>
                </div>
            </div>

            <div class="action-plan">
                <div class="action-plan-header">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                    Action Plan
                </div>
                <div id="actionPlanList"></div>
            </div>

            <button class="reset-btn" onclick="resetForm()" data-testid="btn-reset">
                Start New Analysis
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"></path></svg>
            </button>
        </div>
    </main>

    <footer class="footer">
        <p>&copy; 2025 ExposureEngine by Warubi Sports. Not affiliated with NCAA, MLS NEXT or ECNL.</p>
        <p><a href="/ecosystem.html">Explore Pathways</a></p>
    </footer>

    <script>
        let seasonCount = 1;
        let eventCount = 0;
        let visibilityChart = null;
        let readinessChart = null;

        function updateRangeDisplay(input) {
            const index = input.name.split('_').pop();
            document.getElementById(`minutes_display_${index}`).textContent = input.value + '%';
        }

        function toggleCheckbox(id) {
            const checkbox = document.getElementById(id);
            checkbox.checked = !checkbox.checked;
        }

        function addSeason() {
            const container = document.getElementById('seasonsContainer');
            const index = seasonCount;
            const year = 2024 - index;
            
            const card = document.createElement('div');
            card.className = 'season-card';
            card.dataset.seasonIndex = index;
            card.innerHTML = `
                <button type="button" class="remove-btn" onclick="removeSeason(${index})" data-testid="btn-remove-season-${index}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2"></path></svg>
                </button>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Year</label>
                        <input type="number" class="form-input" name="season_year_${index}" value="${year}" data-testid="input-season-year-${index}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">League</label>
                        <select class="form-select" name="season_league_${index}" data-testid="select-season-league-${index}">
                            <option value="MLS_NEXT">MLS NEXT</option>
                            <option value="ECNL">ECNL</option>
                            <option value="Girls_Academy">Girls Academy</option>
                            <option value="ECNL_RL">ECNL RL</option>
                            <option value="USYS_National_League">USYS National League</option>
                            <option value="USL_Academy">USL Academy</option>
                            <option value="High_School" selected>High School</option>
                            <option value="Elite_Local">Elite Local</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Team Name</label>
                        <input type="text" class="form-input" name="season_team_${index}" placeholder="Club Name" data-testid="input-season-team-${index}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Role</label>
                        <select class="form-select" name="season_role_${index}" data-testid="select-season-role-${index}">
                            <option value="Key_Starter">Key Starter</option>
                            <option value="Rotation" selected>Rotation</option>
                            <option value="Bench">Bench</option>
                            <option value="Injured">Injured</option>
                        </select>
                    </div>
                    <div class="form-group full-width">
                        <label class="form-label">Minutes Played % (Approx)</label>
                        <div class="range-container">
                            <input type="range" class="range-input" name="season_minutes_${index}" min="0" max="100" step="5" value="50" oninput="updateRangeDisplay(this)" data-testid="range-season-minutes-${index}">
                            <span class="range-value" id="minutes_display_${index}">50%</span>
                        </div>
                    </div>
                    <div class="form-group full-width">
                        <label class="form-label">Honors / Notes</label>
                        <input type="text" class="form-input" name="season_honors_${index}" placeholder="e.g. Captain, All-Conference" data-testid="input-season-honors-${index}">
                    </div>
                </div>
            `;
            container.appendChild(card);
            seasonCount++;
            updateRemoveButtons();
        }

        function removeSeason(index) {
            const card = document.querySelector(`.season-card[data-season-index="${index}"]`);
            if (card) card.remove();
            updateRemoveButtons();
        }

        function updateRemoveButtons() {
            const cards = document.querySelectorAll('.season-card');
            cards.forEach((card, i) => {
                const btn = card.querySelector('.remove-btn');
                if (btn) btn.style.display = cards.length > 1 ? 'block' : 'none';
            });
        }

        function addEvent() {
            const container = document.getElementById('eventsContainer');
            if (eventCount === 0) container.innerHTML = '';
            
            const index = eventCount;
            const card = document.createElement('div');
            card.className = 'event-card';
            card.dataset.eventIndex = index;
            card.innerHTML = `
                <button type="button" class="remove-btn" onclick="removeEvent(${index})" data-testid="btn-remove-event-${index}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2"></path></svg>
                </button>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Event Name</label>
                        <input type="text" class="form-input" name="event_name_${index}" placeholder="e.g. MLS NEXT Fest" data-testid="input-event-name-${index}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Type</label>
                        <select class="form-select" name="event_type_${index}" data-testid="select-event-type-${index}">
                            <option value="Showcase">Showcase</option>
                            <option value="ID_Camp">ID Camp</option>
                            <option value="ODP">ODP / Select</option>
                            <option value="HS_Playoffs">HS Playoffs</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group full-width">
                        <label class="form-label">Colleges Noted</label>
                        <input type="text" class="form-input" name="event_colleges_${index}" placeholder="Colleges you spoke to at this event" data-testid="input-event-colleges-${index}">
                    </div>
                </div>
            `;
            container.appendChild(card);
            eventCount++;
        }

        function removeEvent(index) {
            const card = document.querySelector(`.event-card[data-event-index="${index}"]`);
            if (card) card.remove();
            if (document.querySelectorAll('.event-card').length === 0) {
                document.getElementById('eventsContainer').innerHTML = '<p style="font-size: 0.75rem; color: #64748b; text-align: center; padding: 0.75rem;">No events added. National showcases help visibility scoring.</p>';
            }
        }

        function collectSeasons() {
            const seasons = [];
            document.querySelectorAll('.season-card').forEach(card => {
                const index = card.dataset.seasonIndex;
                seasons.push({
                    year: parseInt(document.querySelector(`[name="season_year_${index}"]`)?.value) || 2024,
                    teamName: document.querySelector(`[name="season_team_${index}"]`)?.value || '',
                    league: document.querySelector(`[name="season_league_${index}"]`)?.value || 'ECNL',
                    minutesPlayedPercent: parseInt(document.querySelector(`[name="season_minutes_${index}"]`)?.value) || 50,
                    mainRole: document.querySelector(`[name="season_role_${index}"]`)?.value || 'Rotation',
                    goals: 0,
                    assists: 0,
                    honors: document.querySelector(`[name="season_honors_${index}"]`)?.value || ''
                });
            });
            return seasons;
        }

        function collectEvents() {
            const events = [];
            document.querySelectorAll('.event-card').forEach(card => {
                const index = card.dataset.eventIndex;
                const name = document.querySelector(`[name="event_name_${index}"]`)?.value;
                if (name) {
                    events.push({
                        name: name,
                        type: document.querySelector(`[name="event_type_${index}"]`)?.value || 'Showcase',
                        collegesNoted: document.querySelector(`[name="event_colleges_${index}"]`)?.value || ''
                    });
                }
            });
            return events;
        }

        async function handleSubmit(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.style.display = 'none';
            
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<div class="loading-spinner"></div> Analyzing Trajectory...';
            
            try {
                const formData = {
                    fullName: document.querySelector('[name="fullName"]').value,
                    email: document.querySelector('[name="email"]').value,
                    gradYear: document.querySelector('[name="gradYear"]').value,
                    position: document.querySelector('[name="position"]').value,
                    height: document.querySelector('[name="height"]').value,
                    stateRegion: document.querySelector('[name="stateRegion"]').value,
                    gpa: parseFloat(document.querySelector('[name="gpa"]').value),
                    testScore: document.querySelector('[name="testScore"]').value,
                    seasons: collectSeasons(),
                    hasVideoLink: document.getElementById('hasVideoLink').checked,
                    coachesContacted: parseInt(document.querySelector('[name="coachesContacted"]').value) || 0,
                    responsesReceived: parseInt(document.querySelector('[name="responsesReceived"]').value) || 0,
                    events: collectEvents(),
                    consentToContact: document.getElementById('consentToContact').checked
                };
                
                const response = await fetch('/public/evaluations', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.message || 'Submission failed');
                }
                
                displayResults(result.evaluation);
                
            } catch (error) {
                console.error('Error:', error);
                errorDiv.textContent = error.message || 'Failed to analyze profile. Please try again.';
                errorDiv.style.display = 'block';
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'Calculate Visibility <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"></path></svg>';
            }
        }

        function displayResults(data) {
            document.getElementById('formContainer').style.display = 'none';
            document.getElementById('resultsContainer').classList.add('active');
            
            document.getElementById('summaryText').textContent = data.plainLanguageSummary || 'Analysis complete.';
            
            const badgesContainer = document.getElementById('scoreBadges');
            badgesContainer.innerHTML = data.visibilityScores.map(s => `
                <div class="score-badge">
                    <span class="level">${s.level}</span>
                    <span class="percent">${s.visibilityPercent}%</span>
                </div>
            `).join('');
            
            const strengthsList = document.getElementById('strengthsList');
            strengthsList.innerHTML = (data.keyStrengths || []).map(s => `<li>${s}</li>`).join('');
            
            const risksList = document.getElementById('risksList');
            risksList.innerHTML = (data.keyRisks || []).map(r => `
                <li>
                    <span class="risk-severity ${r.severity.toLowerCase()}">${r.severity}</span>
                    ${r.message}
                </li>
            `).join('');
            
            const actionList = document.getElementById('actionPlanList');
            actionList.innerHTML = (data.actionPlan || []).map(a => `
                <div class="action-item">
                    <span class="action-timeframe ${a.timeframe === 'Next_30_Days' ? 'next-30' : a.timeframe === 'Next_90_Days' ? 'next-90' : 'next-12'}">
                        ${a.timeframe.replace(/_/g, ' ')}
                    </span>
                    <span class="action-description">${a.description}</span>
                    ${a.impact === 'High' ? '<span class="action-impact">High Impact</span>' : ''}
                </div>
            `).join('');
            
            createVisibilityChart(data.visibilityScores);
            createReadinessChart(data.readinessScore);
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function createVisibilityChart(scores) {
            const ctx = document.getElementById('visibilityChart').getContext('2d');
            
            if (visibilityChart) visibilityChart.destroy();
            
            const colors = scores.map(s => {
                if (s.visibilityPercent >= 50) return '#10b981';
                if (s.visibilityPercent >= 20) return '#fbbf24';
                return '#64748b';
            });
            
            visibilityChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: scores.map(s => s.level),
                    datasets: [{
                        data: scores.map(s => s.visibilityPercent),
                        backgroundColor: colors,
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (context) => `${context.raw}% visibility`
                            }
                        }
                    },
                    scales: {
                        x: {
                            max: 100,
                            grid: { color: '#334155' },
                            ticks: { color: '#94a3b8' }
                        },
                        y: {
                            grid: { display: false },
                            ticks: { color: '#e2e8f0', font: { weight: 600 } }
                        }
                    }
                }
            });
        }

        function createReadinessChart(readiness) {
            const ctx = document.getElementById('readinessChart').getContext('2d');
            
            if (readinessChart) readinessChart.destroy();
            
            readinessChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Athletic', 'Technical', 'Tactical', 'Academic', 'Market'],
                    datasets: [{
                        data: [
                            readiness.athletic || 0,
                            readiness.technical || 0,
                            readiness.tactical || 0,
                            readiness.academic || 0,
                            readiness.market || 0
                        ],
                        backgroundColor: 'rgba(16, 185, 129, 0.2)',
                        borderColor: '#10b981',
                        borderWidth: 2,
                        pointBackgroundColor: '#10b981'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            grid: { color: '#334155' },
                            angleLines: { color: '#334155' },
                            pointLabels: { color: '#94a3b8', font: { size: 10 } },
                            ticks: { display: false }
                        }
                    }
                }
            });
        }

        function resetForm() {
            document.getElementById('resultsContainer').classList.remove('active');
            document.getElementById('formContainer').style.display = 'block';
            document.getElementById('evaluationForm').reset();
            document.getElementById('submitBtn').disabled = false;
            document.getElementById('submitBtn').innerHTML = 'Calculate Visibility <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"></path></svg>';
            
            const seasonsContainer = document.getElementById('seasonsContainer');
            seasonsContainer.innerHTML = '';
            seasonCount = 0;
            addSeason();
            
            document.getElementById('eventsContainer').innerHTML = '<p style="font-size: 0.75rem; color: #64748b; text-align: center; padding: 0.75rem;">No events added. National showcases help visibility scoring.</p>';
            eventCount = 0;
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        document.getElementById('evaluationForm').addEventListener('submit', handleSubmit);
    </script>
</body>
</html>
