openapi: 3.0.3
info:
  title: Warubi Platform - FC Köln ITP API
  description: |
    RESTful API for the 1.FC Köln International Talent Program management system.
    
    ## Authentication
    All authenticated endpoints require a Bearer token in the Authorization header.
    Tokens are obtained via the `/api/fckoln/auth/login` endpoint.
    
    ## Multi-Tenancy
    This API supports multiple applications via the `X-App-Key` header.
    Contact support to obtain your application credentials.
    
    ## Rate Limiting
    Requests are rate limited per application. Check response headers for:
    - `X-RateLimit-Limit`: Maximum requests per window
    - `X-RateLimit-Remaining`: Remaining requests in current window
    - `X-RateLimit-Reset`: Unix timestamp when window resets
  version: 1.0.0
  contact:
    name: Warubi Platform Support
    email: support@warubi.io

servers:
  - url: /api/fckoln
    description: FC Köln ITP API

tags:
  - name: Authentication
    description: User authentication and password management
  - name: Events
    description: Calendar events and attendance tracking
  - name: Players
    description: Player management and profiles
  - name: Chores
    description: House chore assignments and verification
  - name: Grocery
    description: Grocery ordering system with budget controls

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from login endpoint

  schemas:
    Error:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: Invalid request
        correlationId:
          type: string
          format: uuid
          description: Request correlation ID for debugging

    Pagination:
      type: object
      properties:
        page:
          type: integer
          minimum: 1
          example: 1
        limit:
          type: integer
          minimum: 1
          maximum: 100
          example: 50
        total:
          type: integer
          example: 125

    User:
      type: object
      properties:
        id:
          type: integer
        email:
          type: string
          format: email
        firstName:
          type: string
        lastName:
          type: string
        role:
          type: string
          enum: [player, staff, admin]

    Event:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        eventType:
          type: string
          enum: [training, match, meeting, medical, other]
        date:
          type: string
          format: date
        startTime:
          type: string
          pattern: "^([01]?[0-9]|2[0-3]):[0-5][0-9]$"
        endTime:
          type: string
          pattern: "^([01]?[0-9]|2[0-3]):[0-5][0-9]$"
        location:
          type: string
        notes:
          type: string
        isRecurring:
          type: boolean
        recurringPattern:
          type: string
          enum: [daily, weekly, monthly]

    Player:
      type: object
      properties:
        id:
          type: integer
        firstName:
          type: string
        lastName:
          type: string
        position:
          type: string
        house:
          type: string
        healthStatus:
          type: string
          enum: [healthy, injured, recovering]
        injuryType:
          type: string
          nullable: true

    Chore:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        description:
          type: string
        house:
          type: string
        assignedTo:
          type: integer
        dueDate:
          type: string
          format: date
        status:
          type: string
          enum: [pending, completed, verified, rejected]

    GroceryItem:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        category:
          type: string
        price:
          type: number
          format: decimal

    GroceryOrder:
      type: object
      properties:
        id:
          type: integer
        userId:
          type: integer
        deliveryDate:
          type: string
          format: date
        totalAmount:
          type: number
          format: decimal
        status:
          type: string
          enum: [pending, approved, delivered, cancelled]

  responses:
    Unauthorized:
      description: Authentication required or token invalid
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Forbidden:
      description: Insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    RateLimited:
      description: Too many requests
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

paths:
  /healthz:
    get:
      summary: Health check
      tags: [System]
      responses:
        '200':
          description: Health OK

  /auth/login:
    post:
      tags: [Authentication]
      summary: User login
      description: Authenticate user and receive JWT token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  minLength: 8
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  token:
                    type: string
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          description: Invalid credentials
        '429':
          $ref: '#/components/responses/RateLimited'

  /auth/request-reset:
    post:
      tags: [Authentication]
      summary: Request password reset
      description: Send password reset email to user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email]
              properties:
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: Reset email sent (if account exists)
        '429':
          $ref: '#/components/responses/RateLimited'

  /auth/reset-password:
    post:
      tags: [Authentication]
      summary: Reset password
      description: Set new password using reset token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [token, newPassword]
              properties:
                token:
                  type: string
                newPassword:
                  type: string
                  minLength: 8
      responses:
        '200':
          description: Password reset successful
        '400':
          description: Invalid or expired token

  /events:
    get:
      tags: [Events]
      summary: List events
      security:
        - BearerAuth: []
      parameters:
        - name: startDate
          in: query
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          schema:
            type: string
            format: date
        - name: type
          in: query
          schema:
            type: string
            enum: [training, match, meeting, medical, other]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: Events list
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  events:
                    type: array
                    items:
                      $ref: '#/components/schemas/Event'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'
    post:
      tags: [Events]
      summary: Create event
      description: Staff/Admin only
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [title, eventType, date, startTime, endTime]
              properties:
                title:
                  type: string
                eventType:
                  type: string
                date:
                  type: string
                  format: date
                startTime:
                  type: string
                endTime:
                  type: string
                location:
                  type: string
                notes:
                  type: string
      responses:
        '201':
          description: Event created
        '403':
          $ref: '#/components/responses/Forbidden'

  /events/{id}:
    put:
      tags: [Events]
      summary: Update event
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Event updated
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [Events]
      summary: Delete event
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Event deleted
        '404':
          $ref: '#/components/responses/NotFound'

  /events/{id}/attendance:
    get:
      tags: [Events]
      summary: Get event attendance
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Attendance list
    post:
      tags: [Events]
      summary: Record attendance
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [status]
              properties:
                userId:
                  type: integer
                status:
                  type: string
                  enum: [present, absent, late, excused]
      responses:
        '200':
          description: Attendance recorded

  /players:
    get:
      tags: [Players]
      summary: List players
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: Players list
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  players:
                    type: array
                    items:
                      $ref: '#/components/schemas/Player'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  /players/overview:
    get:
      tags: [Players]
      summary: Players health overview
      description: Staff/Admin only. Get player status summary.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Overview with health summary
        '403':
          $ref: '#/components/responses/Forbidden'

  /players/{id}/injury:
    put:
      tags: [Players]
      summary: Update injury status
      description: Staff/Admin only
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [healthStatus]
              properties:
                healthStatus:
                  type: string
                  enum: [healthy, injured, recovering]
                injuryType:
                  type: string
                injuryDate:
                  type: string
                  format: date
                injuryEndDate:
                  type: string
                  format: date
      responses:
        '200':
          description: Injury status updated
        '403':
          $ref: '#/components/responses/Forbidden'

  /players/profile:
    get:
      tags: [Players]
      summary: Get own profile
      security:
        - BearerAuth: []
      responses:
        '200':
          description: User profile
    put:
      tags: [Players]
      summary: Update own profile
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                firstName:
                  type: string
                lastName:
                  type: string
                phoneNumber:
                  type: string
                emergencyContactName:
                  type: string
                emergencyContactPhone:
                  type: string
      responses:
        '200':
          description: Profile updated

  /chores:
    get:
      tags: [Chores]
      summary: List chores
      security:
        - BearerAuth: []
      parameters:
        - name: house
          in: query
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, completed, verified, rejected]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: Chores list
    post:
      tags: [Chores]
      summary: Create chore
      description: Staff/Admin only
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [title, house]
              properties:
                title:
                  type: string
                description:
                  type: string
                house:
                  type: string
                assignedTo:
                  type: integer
                dueDate:
                  type: string
                  format: date
      responses:
        '201':
          description: Chore created
        '403':
          $ref: '#/components/responses/Forbidden'

  /chores/{id}/complete:
    post:
      tags: [Chores]
      summary: Mark chore complete
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Chore marked complete

  /chores/{id}/verify:
    put:
      tags: [Chores]
      summary: Verify chore completion
      description: Staff/Admin only
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [verified]
              properties:
                verified:
                  type: boolean
      responses:
        '200':
          description: Chore verified/rejected
        '403':
          $ref: '#/components/responses/Forbidden'

  /grocery/items:
    get:
      tags: [Grocery]
      summary: List grocery items
      security:
        - BearerAuth: []
      parameters:
        - name: category
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Available grocery items
    post:
      tags: [Grocery]
      summary: Add grocery item
      description: Staff/Admin only
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [name, category, price]
              properties:
                name:
                  type: string
                category:
                  type: string
                price:
                  type: number
      responses:
        '201':
          description: Item created
        '403':
          $ref: '#/components/responses/Forbidden'

  /grocery/orders:
    get:
      tags: [Grocery]
      summary: List orders
      description: Players see own orders, staff see all
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Orders list
    post:
      tags: [Grocery]
      summary: Place order
      description: Subject to weekly budget limit (30 EUR)
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [deliveryDate, items]
              properties:
                deliveryDate:
                  type: string
                  format: date
                items:
                  type: array
                  items:
                    type: object
                    required: [itemId, quantity]
                    properties:
                      itemId:
                        type: integer
                      quantity:
                        type: integer
                        minimum: 1
      responses:
        '201':
          description: Order placed
        '400':
          description: Budget exceeded or invalid items

  /grocery/orders/{id}:
    get:
      tags: [Grocery]
      summary: Get order details
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Order with items
        '403':
          description: Not authorized to view this order
        '404':
          $ref: '#/components/responses/NotFound'
