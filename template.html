<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1.FC K√∂ln Bundesliga Talent Program</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }
        
        /* Authentication Styles */
        .auth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
            background: linear-gradient(135deg, #dc143c 0%, #8b0000 100%);
        }
        
        .auth-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 400px;
        }
        
        .auth-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        
        .auth-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 1rem;
            border-radius: 50%;
            background: #dc143c;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }
        
        .auth-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .auth-subtitle {
            color: #666;
            font-size: 0.9rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #dc143c;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            text-align: center;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
        }
        
        .btn-primary {
            background: #dc143c;
            color: white;
        }
        
        .btn-primary:hover {
            background: #b71c1c;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
        }
        
        .btn-secondary:hover {
            background: #e5e7eb;
        }
        
        .auth-links {
            text-align: center;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e5e7eb;
        }
        
        .auth-link {
            color: #dc143c;
            text-decoration: none;
            font-size: 0.9rem;
        }
        
        .auth-link:hover {
            text-decoration: underline;
        }
        
        /* Main App Styles (hidden initially) */
        .main-app {
            display: none;
        }
        
        .header {
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 1rem 2rem;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #dc143c;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }
        
        .app-title {
            color: #333;
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-name {
            color: #333;
            font-weight: 500;
        }
        
        .logout-btn {
            padding: 8px 16px;
            background: #dc143c;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            overflow: hidden;
        }
        
        .nav-tab {
            flex: 1;
            padding: 1rem;
            text-align: center;
            background: #f9fafb;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.2s;
        }
        
        .nav-tab.active {
            background: #dc143c;
            color: white;
        }
        
        .nav-tab:hover {
            background: #fee2e2;
            color: #dc143c;
        }
        
        .nav-tab.active:hover {
            background: #b91c1c;
            color: white;
        }
        
        .section {
            display: none;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 2rem;
        }
        
        .section.active {
            display: block;
        }
        
        .section h2 {
            color: #333;
            margin-bottom: 1.5rem;
            font-size: 1.75rem;
        }
        
        /* Message Styles */
        .message {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            display: none;
        }
        
        .message.show {
            display: block;
        }
        
        .message.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        
        .message.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }
        
        .message.info {
            background: #e0f2fe;
            color: #0c4a6e;
            border: 1px solid #0ea5e9;
        }
        
        /* Dashboard Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #dc143c, #b91c1c);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        /* Players Section Styles */
        .players-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .players-controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .search-input {
            padding: 10px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            min-width: 250px;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #dc143c;
        }
        
        .filter-select {
            padding: 10px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            min-width: 120px;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: #dc143c;
        }
        
        .players-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .players-table th {
            background: #f9fafb;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .players-table td {
            padding: 15px;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .players-table tr:hover {
            background: #f9fafb;
        }
        
        .status-active {
            background: #d1fae5;
            color: #065f46;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .status-injured {
            background: #fee2e2;
            color: #991b1b;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .status-suspended {
            background: #fef3c7;
            color: #92400e;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 0.875rem;
            border-radius: 6px;
            margin-right: 0.5rem;
        }
        
        .btn-accent {
            background: #0ea5e9;
            color: white;
            border: none;
        }
        
        .btn-accent:hover {
            background: #0284c7;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
            border: none;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            margin: 20px;
            position: relative;
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6b7280;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
        }
        
        .modal-close:hover {
            background: #f3f4f6;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        /* Player Detail Styles */
        .player-detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .player-detail-section {
            background: #f9fafb;
            border-radius: 8px;
            padding: 1.5rem;
        }
        
        .player-detail-section.full-width {
            grid-column: 1 / -1;
        }
        
        .player-detail-section h4 {
            color: #333;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            border-bottom: 2px solid #dc143c;
            padding-bottom: 0.5rem;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .detail-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .detail-label {
            font-weight: 600;
            color: #374151;
        }
        
        .detail-value {
            color: #6b7280;
        }
        
        .performance-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .stat-item {
            text-align: center;
            background: white;
            padding: 1rem;
            border-radius: 8px;
        }
        
        .stat-number {
            font-size: 1.75rem;
            font-weight: 700;
            color: #dc143c;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.5rem;
        }
        
        .player-detail-actions {
            padding: 1.5rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .notes-content {
            background: white;
            padding: 1rem;
            border-radius: 6px;
            border-left: 4px solid #dc143c;
            font-style: italic;
            color: #374151;
        }
        
        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.2s;
        }
        
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #dc143c;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            padding-top: 1.5rem;
            border-top: 1px solid #e5e7eb;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header-content {
                padding: 0 1rem;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
            
            .nav-tab {
                min-width: 120px;
            }
            
            .players-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .players-controls {
                justify-content: stretch;
            }
            
            .players-controls > * {
                flex: 1;
                min-width: 0;
            }
            
            .players-table {
                font-size: 0.875rem;
            }
            
            .players-table th,
            .players-table td {
                padding: 10px;
            }
            
            .modal-content {
                margin: 10px;
                max-width: none;
            }
            
            .player-detail-grid {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div id="authContainer" class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <div class="auth-logo">
                    <img src="/api/logo" alt="FC K√∂ln" style="width: 60px; height: 60px; border-radius: 50%;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div style="display: none; width: 60px; height: 60px; background: #dc143c; border-radius: 50%; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 16px;">FCK</div>
                </div>
                <h1 class="auth-title">FC K√∂ln</h1>
                <p class="auth-subtitle">Bundesliga Talent Program</p>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="btn btn-primary">Sign In</button>
            </form>
            
            <div class="auth-links">
                <a href="#" class="auth-link" onclick="showForgotPassword()">Forgot your password?</a>
            </div>
        </div>
    </div>
    
    <!-- Success/Error Messages -->
    <div id="successMessage" class="message success"></div>
    <div id="errorMessage" class="message error"></div>
    <div id="infoMessage" class="message info"></div>
    
    <!-- Main Application -->
    <div id="mainApp" class="main-app">
        <header class="header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo">
                        <img src="/api/logo" alt="FC K√∂ln" style="width: 40px; height: 40px; border-radius: 50%;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div style="display: none; width: 40px; height: 40px; background: #dc143c; border-radius: 50%; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 14px;">FCK</div>
                    </div>
                    <h1 class="app-title">1.FC K√∂ln Bundesliga Talent Program</h1>
                </div>
                <div class="user-info">
                    <span id="userName" class="user-name"></span>
                    <button onclick="logout()" class="logout-btn">Logout</button>
                </div>
            </div>
        </header>
        
        <div class="container">
            <nav class="nav-tabs">
                <button class="nav-tab active" onclick="showSection('dashboard')">üè† Dashboard</button>
                <button class="nav-tab" onclick="showSection('players')">‚öΩ Players</button>
                <button class="nav-tab" onclick="showSection('housing')">üè† Housing & Chores</button>
                <button class="nav-tab" onclick="showSection('calendar')">üìÖ Calendar</button>
                <button class="nav-tab" onclick="showSection('food')">üçΩÔ∏è Food Ordering</button>
                <button class="nav-tab" onclick="showSection('communications')">üí¨ Communications</button>
            </nav>
            
            <!-- Dashboard Section -->
            <section id="dashboard" class="section active">
                <h2>Dashboard</h2>
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div id="totalPlayers" class="stat-number">0</div>
                        <div class="stat-label">Total Players</div>
                    </div>
                    <div class="stat-card">
                        <div id="trainingToday" class="stat-number">0</div>
                        <div class="stat-label">Training Today</div>
                    </div>
                    <div class="stat-card">
                        <div id="totalHouses" class="stat-number">3</div>
                        <div class="stat-label">Houses</div>
                    </div>
                    <div class="stat-card">
                        <div id="activitiesToday" class="stat-number">0</div>
                        <div class="stat-label">Activities Today</div>
                    </div>
                </div>
                <div id="recentActivity">
                    <h3>Recent Activity</h3>
                    <div id="activityList"></div>
                </div>
            </section>
            
            <!-- Players Section -->
            <section id="players" class="section">
                <div class="players-header">
                    <h2>Player Management</h2>
                    <div class="players-controls">
                        <input type="text" id="playerSearch" class="search-input" placeholder="Search players...">
                        <select id="positionFilter" class="filter-select">
                            <option value="">All Positions</option>
                            <option value="Goalkeeper">Goalkeeper</option>
                            <option value="Defender">Defender</option>
                            <option value="Midfielder">Midfielder</option>
                            <option value="Forward">Forward</option>
                        </select>
                        <select id="houseFilter" class="filter-select">
                            <option value="">All Houses</option>
                            <option value="W1">Widdersdorf 1</option>
                            <option value="W2">Widdersdorf 2</option>
                            <option value="W3">Widdersdorf 3</option>
                        </select>
                        <select id="statusFilter" class="filter-select">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="injured">Injured</option>
                            <option value="suspended">Suspended</option>
                            <option value="on-loan">On Loan</option>
                        </select>
                        <button class="btn btn-primary" onclick="showAddPlayerModal()">Add Player</button>
                        <button class="btn btn-secondary" onclick="exportPlayersCSV()">Export CSV</button>
                    </div>
                </div>
                <div id="playersTable"></div>
            </section>
            
            <!-- Housing & Chores Section -->
            <section id="housing" class="section">
                <h2>Housing & Chore Management</h2>
                <p>Housing and chore management functionality will be displayed here.</p>
            </section>
            
            <!-- Calendar Section -->
            <section id="calendar" class="section">
                <h2>Event Calendar</h2>
                <p>Calendar functionality will be displayed here.</p>
            </section>
            
            <!-- Food Ordering Section -->
            <section id="food" class="section">
                <h2>Food Ordering</h2>
                <p>Food ordering functionality will be displayed here.</p>
            </section>
            
            <!-- Communications Section -->
            <section id="communications" class="section">
                <h2>Internal Communications</h2>
                <p>Communications functionality will be displayed here.</p>
            </section>
        </div>
    </div>
    
    <!-- Player Detail Modal -->
    <div id="playerDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="playerDetailTitle" class="modal-title">Player Details</h3>
                <button class="modal-close" onclick="closePlayerDetailModal()">&times;</button>
            </div>
            <div id="playerDetailContent" class="modal-body">
                <!-- Player details will be populated here -->
            </div>
        </div>
    </div>
    
    <!-- Player Form Modal -->
    <div id="playerFormModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="playerFormTitle" class="modal-title">Add New Player</h3>
                <button class="modal-close" onclick="closePlayerFormModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="playerForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="playerName">Full Name *</label>
                            <input type="text" id="playerName" required>
                        </div>
                        <div class="form-group">
                            <label for="playerAge">Age *</label>
                            <input type="number" id="playerAge" min="16" max="25" required>
                        </div>
                        <div class="form-group">
                            <label for="playerPosition">Position *</label>
                            <select id="playerPosition" required>
                                <option value="">Select Position</option>
                                <option value="Goalkeeper">Goalkeeper</option>
                                <option value="Defender">Defender</option>
                                <option value="Midfielder">Midfielder</option>
                                <option value="Forward">Forward</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="playerHouse">House Assignment *</label>
                            <select id="playerHouse" required>
                                <option value="">Select House</option>
                                <option value="W1">Widdersdorf 1</option>
                                <option value="W2">Widdersdorf 2</option>
                                <option value="W3">Widdersdorf 3</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="playerNationality">Nationality</label>
                            <input type="text" id="playerNationality">
                        </div>
                        <div class="form-group">
                            <label for="playerStatus">Status</label>
                            <select id="playerStatus">
                                <option value="active">Active</option>
                                <option value="injured">Injured</option>
                                <option value="suspended">Suspended</option>
                                <option value="on-loan">On Loan</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="playerHeight">Height (cm)</label>
                            <input type="number" id="playerHeight" min="150" max="220">
                        </div>
                        <div class="form-group">
                            <label for="playerWeight">Weight (kg)</label>
                            <input type="number" id="playerWeight" min="50" max="120">
                        </div>
                        <div class="form-group">
                            <label for="playerPhone">Phone Number</label>
                            <input type="tel" id="playerPhone">
                        </div>
                        <div class="form-group">
                            <label for="playerEmail">Email Address</label>
                            <input type="email" id="playerEmail">
                        </div>
                        <div class="form-group">
                            <label for="playerEmergencyContact">Emergency Contact</label>
                            <input type="text" id="playerEmergencyContact">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="playerNotes">Additional Notes</label>
                        <textarea id="playerNotes" placeholder="Any additional information about the player..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closePlayerFormModal()">Cancel</button>
                        <button type="button" class="btn btn-primary" onclick="savePlayer()">Save Player</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let currentUser = null;
        let players = [];
        
        // Authentication functions
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentUser = data.user;
                    document.getElementById('userName').textContent = currentUser.name;
                    document.getElementById('authContainer').style.display = 'none';
                    document.getElementById('mainApp').style.display = 'block';
                    
                    // Load initial data
                    await loadDashboardData();
                    await loadPlayers();
                    
                    showSuccessMessage('Welcome back, ' + currentUser.name + '!');
                } else {
                    showErrorMessage(data.message || 'Login failed');
                }
            } catch (error) {
                showErrorMessage('Connection error. Please try again.');
            }
        });
        
        async function logout() {
            try {
                await fetch('/api/auth/logout', { method: 'POST' });
                currentUser = null;
                document.getElementById('authContainer').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('loginForm').reset();
            } catch (error) {
                console.error('Logout error:', error);
            }
        }
        
        // Navigation functions
        function showSection(sectionName) {
            // Hide all sections
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => section.classList.remove('active'));
            
            // Hide all nav tabs
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected section and tab
            document.getElementById(sectionName).classList.add('active');
            event.target.classList.add('active');
        }
        
        // Message functions
        function showSuccessMessage(message) {
            const msgElement = document.getElementById('successMessage');
            msgElement.textContent = message;
            msgElement.classList.add('show');
            setTimeout(() => msgElement.classList.remove('show'), 5000);
        }
        
        function showErrorMessage(message) {
            const msgElement = document.getElementById('errorMessage');
            msgElement.textContent = message;
            msgElement.classList.add('show');
            setTimeout(() => msgElement.classList.remove('show'), 5000);
        }
        
        function showInfoMessage(message) {
            const msgElement = document.getElementById('infoMessage');
            msgElement.textContent = message;
            msgElement.classList.add('show');
            setTimeout(() => msgElement.classList.remove('show'), 5000);
        }
        
        // Dashboard functions
        async function loadDashboardData() {
            try {
                const response = await fetch('/api/dashboard/stats');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('totalPlayers').textContent = data.stats.totalPlayers;
                    document.getElementById('trainingToday').textContent = data.stats.trainingToday;
                    document.getElementById('totalHouses').textContent = data.stats.houses;
                    document.getElementById('activitiesToday').textContent = data.stats.activitiesToday;
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }
        
        // Player management functions
        async function loadPlayers() {
            try {
                const response = await fetch('/api/players');
                const data = await response.json();
                
                if (data.success) {
                    players = data.players;
                    renderPlayersTable();
                }
            } catch (error) {
                console.error('Error loading players:', error);
            }
        }
        
        function renderPlayersTable() {
            const container = document.getElementById('playersTable');
            const searchTerm = document.getElementById('playerSearch')?.value.toLowerCase() || '';
            const positionFilter = document.getElementById('positionFilter')?.value || '';
            const houseFilter = document.getElementById('houseFilter')?.value || '';
            const statusFilter = document.getElementById('statusFilter')?.value || '';
            
            // Filter players
            let filteredPlayers = players.filter(player => {
                const matchesSearch = player.name.toLowerCase().includes(searchTerm);
                const matchesPosition = !positionFilter || player.position === positionFilter;
                const matchesHouse = !houseFilter || player.house === houseFilter;
                const matchesStatus = !statusFilter || player.status === statusFilter;
                
                return matchesSearch && matchesPosition && matchesHouse && matchesStatus;
            });
            
            if (filteredPlayers.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 2rem;">No players found matching your criteria.</p>';
                return;
            }
            
            let html = '<table class="players-table">' +
                '<thead>' +
                    '<tr>' +
                        '<th>Name</th>' +
                        '<th>Age</th>' +
                        '<th>Position</th>' +
                        '<th>House</th>' +
                        '<th>Status</th>' +
                        '<th>Actions</th>' +
                    '</tr>' +
                '</thead>' +
                '<tbody>';
                
            filteredPlayers.forEach(player => {
                const statusClass = 'status-' + player.status;
                const statusText = player.status.charAt(0).toUpperCase() + player.status.slice(1);
                const houseName = formatHouseName(player.house);
                
                html += '<tr>' +
                    '<td><strong>' + player.name + '</strong></td>' +
                    '<td>' + player.age + '</td>' +
                    '<td>‚öΩ ' + player.position + '</td>' +
                    '<td>' + houseName + '</td>' +
                    '<td><span class="' + statusClass + '">' + statusText + '</span></td>' +
                    '<td>' +
                        '<button class="btn btn-small btn-accent" onclick="viewPlayerDetails(\'' + player.id + '\')">View</button>';
                        
                if (currentUser && currentUser.role === 'admin') {
                    html += '<button class="btn btn-small btn-primary" onclick="editPlayer(\'' + player.id + '\')">Edit</button>' +
                        '<button class="btn btn-small btn-danger" onclick="confirmDeletePlayer(\'' + player.id + '\')">Delete</button>';
                }
                
                html += '</td>' +
                '</tr>';
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
            
            // Add search event listener
            document.getElementById('playerSearch').addEventListener('input', renderPlayersTable);
            document.getElementById('positionFilter').addEventListener('change', renderPlayersTable);
            document.getElementById('houseFilter').addEventListener('change', renderPlayersTable);
            document.getElementById('statusFilter').addEventListener('change', renderPlayersTable);
        }
        
        function formatHouseName(house) {
            const houseNames = {
                'W1': 'Widdersdorf 1',
                'W2': 'Widdersdorf 2',
                'W3': 'Widdersdorf 3'
            };
            return houseNames[house] || house;
        }
        
        function showAddPlayerModal() {
            const modal = document.getElementById('playerFormModal');
            const form = document.getElementById('playerForm');
            
            document.getElementById('playerFormTitle').textContent = 'Add New Player';
            form.reset();
            form.removeAttribute('data-mode');
            form.removeAttribute('data-player-id');
            
            modal.style.display = 'flex';
        }
        
        function closePlayerFormModal() {
            document.getElementById('playerFormModal').style.display = 'none';
        }
        
        function viewPlayerDetails(playerId) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;
            
            const modal = document.getElementById('playerDetailModal');
            const title = document.getElementById('playerDetailTitle');
            const content = document.getElementById('playerDetailContent');
            
            title.textContent = player.name;
            
            const joinDate = new Date(player.joinDate).toLocaleDateString();
            const statusClass = 'status-' + player.status;
            const statusText = player.status.charAt(0).toUpperCase() + player.status.slice(1);
            
            let html = '<div class="player-detail-grid">' +
                '<div class="player-detail-section">' +
                    '<h4>üìã Basic Information</h4>' +
                    '<div class="detail-row">' +
                        '<span class="detail-label">Full Name:</span>' +
                        '<span class="detail-value">' + player.name + '</span>' +
                    '</div>' +
                    '<div class="detail-row">' +
                        '<span class="detail-label">Age:</span>' +
                        '<span class="detail-value">' + player.age + ' years old</span>' +
                    '</div>' +
                    '<div class="detail-row">' +
                        '<span class="detail-label">Position:</span>' +
                        '<span class="detail-value">‚öΩ ' + player.position + '</span>' +
                    '</div>' +
                    '<div class="detail-row">' +
                        '<span class="detail-label">Current Status:</span>' +
                        '<span class="detail-value ' + statusClass + '">' + statusText + '</span>' +
                    '</div>' +
                    '<div class="detail-row">' +
                        '<span class="detail-label">Nationality:</span>' +
                        '<span class="detail-value">' + (player.nationality || 'Not specified') + '</span>' +
                    '</div>' +
                    '<div class="detail-row">' +
                        '<span class="detail-label">Joined Program:</span>' +
                        '<span class="detail-value">' + joinDate + '</span>' +
                    '</div>' +
                '</div>' +
                
                '<div class="player-detail-section">' +
                    '<h4>üè† Housing & Contact</h4>' +
                    '<div class="detail-row">' +
                        '<span class="detail-label">House Assignment:</span>' +
                        '<span class="detail-value">' + formatHouseName(player.house) + '</span>' +
                    '</div>' +
                    '<div class="detail-row">' +
                        '<span class="detail-label">Phone:</span>' +
                        '<span class="detail-value">' + (player.phone || 'Not provided') + '</span>' +
                    '</div>' +
                    '<div class="detail-row">' +
                        '<span class="detail-label">Email:</span>' +
                        '<span class="detail-value">' + (player.email || 'Not provided') + '</span>' +
                    '</div>' +
                    '<div class="detail-row">' +
                        '<span class="detail-label">Emergency Contact:</span>' +
                        '<span class="detail-value">' + (player.emergencyContact || 'Not provided') + '</span>' +
                    '</div>' +
                '</div>' +
                
                '<div class="player-detail-section">' +
                    '<h4>üí™ Physical Profile</h4>' +
                    '<div class="detail-row">' +
                        '<span class="detail-label">Height:</span>' +
                        '<span class="detail-value">' + (player.height ? player.height + ' cm' : 'Not recorded') + '</span>' +
                    '</div>' +
                    '<div class="detail-row">' +
                        '<span class="detail-label">Weight:</span>' +
                        '<span class="detail-value">' + (player.weight ? player.weight + ' kg' : 'Not recorded') + '</span>' +
                    '</div>' +
                    '<div class="detail-row">' +
                        '<span class="detail-label">BMI:</span>' +
                        '<span class="detail-value">' + calculateBMI(player.height, player.weight) + '</span>' +
                    '</div>' +
                '</div>' +
                
                '<div class="player-detail-section">' +
                    '<h4>üìä Performance Summary</h4>' +
                    '<div class="performance-stats">' +
                        '<div class="stat-item">' +
                            '<div class="stat-number">87%</div>' +
                            '<div class="stat-label">Training Attendance</div>' +
                        '</div>' +
                        '<div class="stat-item">' +
                            '<div class="stat-number">42</div>' +
                            '<div class="stat-label">Days in Program</div>' +
                        '</div>' +
                        '<div class="stat-item">' +
                            '<div class="stat-number">8.2</div>' +
                            '<div class="stat-label">Coach Rating</div>' +
                        '</div>' +
                    '</div>' +
                '</div>';
                
            if (player.notes) {
                html += '<div class="player-detail-section full-width">' +
                    '<h4>üìù Additional Notes</h4>' +
                    '<div class="notes-content">' + player.notes + '</div>' +
                '</div>';
            }
            
            html += '</div>' +
                '<div class="player-detail-actions">';
                
            if (currentUser.role === 'admin') {
                html += '<button class="btn btn-primary" onclick="editPlayer(\'' + player.id + '\')">‚úèÔ∏è Edit Player</button>' +
                    '<button class="btn btn-danger" onclick="confirmDeletePlayer(\'' + player.id + '\')">üóëÔ∏è Delete Player</button>';
            }
            
            html += '<button class="btn btn-secondary" onclick="generatePlayerReport(\'' + player.id + '\')">üìÑ Generate Report</button>' +
                '<button class="btn btn-accent" onclick="viewPerformanceMetrics(\'' + player.id + '\')">üìà Performance</button>' +
                '</div>';
            
            content.innerHTML = html;
            
            modal.style.display = 'flex';
        }
        
        function closePlayerDetailModal() {
            document.getElementById('playerDetailModal').style.display = 'none';
        }
        
        function calculateBMI(height, weight) {
            if (!height || !weight) return 'Not calculated';
            const bmi = weight / Math.pow(height / 100, 2);
            return bmi.toFixed(1);
        }
        
        function editPlayer(playerId) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;
            
            // Close detail modal if open
            document.getElementById('playerDetailModal').style.display = 'none';
            
            // Open form modal in edit mode
            const modal = document.getElementById('playerFormModal');
            const form = document.getElementById('playerForm');
            
            document.getElementById('playerFormTitle').textContent = 'Edit Player';
            
            // Populate form with current data
            document.getElementById('playerName').value = player.name || '';
            document.getElementById('playerAge').value = player.age || '';
            document.getElementById('playerPosition').value = player.position || '';
            document.getElementById('playerHouse').value = player.house || '';
            document.getElementById('playerNationality').value = player.nationality || '';
            document.getElementById('playerStatus').value = player.status || 'active';
            document.getElementById('playerHeight').value = player.height || '';
            document.getElementById('playerWeight').value = player.weight || '';
            document.getElementById('playerPhone').value = player.phone || '';
            document.getElementById('playerEmail').value = player.email || '';
            document.getElementById('playerEmergencyContact').value = player.emergencyContact || '';
            document.getElementById('playerNotes').value = player.notes || '';
            
            // Set form in edit mode
            form.dataset.mode = 'edit';
            form.dataset.playerId = playerId;
            
            modal.style.display = 'flex';
        }
        
        async function savePlayer() {
            const form = document.getElementById('playerForm');
            const mode = form.dataset.mode || 'add';
            const playerId = form.dataset.playerId;
            
            const playerData = {
                name: document.getElementById('playerName').value,
                age: parseInt(document.getElementById('playerAge').value),
                position: document.getElementById('playerPosition').value,
                house: document.getElementById('playerHouse').value,
                nationality: document.getElementById('playerNationality').value,
                status: document.getElementById('playerStatus').value,
                height: parseInt(document.getElementById('playerHeight').value) || null,
                weight: parseInt(document.getElementById('playerWeight').value) || null,
                phone: document.getElementById('playerPhone').value,
                email: document.getElementById('playerEmail').value,
                emergencyContact: document.getElementById('playerEmergencyContact').value,
                notes: document.getElementById('playerNotes').value
            };
            
            try {
                const url = mode === 'edit' ? '/api/players/' + playerId : '/api/players';
                const method = mode === 'edit' ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(playerData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Close modal and refresh
                    document.getElementById('playerFormModal').style.display = 'none';
                    form.reset();
                    form.removeAttribute('data-mode');
                    form.removeAttribute('data-player-id');
                    
                    await loadPlayers();
                    showSuccessMessage('Player ' + (mode === 'edit' ? 'updated' : 'added') + ' successfully!');
                } else {
                    showErrorMessage(data.message || 'Failed to save player');
                }
            } catch (error) {
                console.error('Error saving player:', error);
                showErrorMessage('Failed to save player. Please try again.');
            }
        }
        
        async function confirmDeletePlayer(playerId) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;
            
            if (confirm('Are you sure you want to delete player "' + player.name + '"? This action cannot be undone.')) {
                await deletePlayer(playerId);
            }
        }
        
        async function deletePlayer(playerId) {
            try {
                const response = await fetch('/api/players/' + playerId, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    await loadPlayers();
                    showSuccessMessage('Player deleted successfully');
                    
                    // Close detail modal if it's open for this player
                    const modal = document.getElementById('playerDetailModal');
                    if (modal.style.display === 'flex') {
                        modal.style.display = 'none';
                    }
                } else {
                    showErrorMessage(data.message || 'Failed to delete player');
                }
            } catch (error) {
                console.error('Error deleting player:', error);
                showErrorMessage('Failed to delete player. Please try again.');
            }
        }
        
        function viewPerformanceMetrics(playerId) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;
            
            // This would integrate with a performance tracking system
            showInfoMessage('Performance metrics for ' + player.name + ' would be displayed here in a future update.');
        }
        
        function generatePlayerReport(playerId) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;
            
            // Generate a comprehensive player report
            showInfoMessage('Generating comprehensive report for ' + player.name + '...');
        }
        
        function exportPlayersCSV() {
            if (players.length === 0) {
                alert('No players to export.');
                return;
            }
            
            let csvContent = 'Name,Age,Position,House,Status,Nationality,Height,Weight,Phone,Email,Emergency Contact,Notes,Join Date\n';
            
            players.forEach(player => {
                const row = [
                    '"' + (player.name || '') + '"',
                    player.age || '',
                    '"' + (player.position || '') + '"',
                    '"' + (formatHouseName(player.house) || '') + '"',
                    '"' + (player.status || '') + '"',
                    '"' + (player.nationality || '') + '"',
                    player.height || '',
                    player.weight || '',
                    '"' + (player.phone || '') + '"',
                    '"' + (player.email || '') + '"',
                    '"' + (player.emergencyContact || '') + '"',
                    '"' + (player.notes || '') + '"',
                    '"' + (new Date(player.joinDate).toLocaleDateString() || '') + '"'
                ].join(',');
                csvContent += row + '\n';
            });
            
            // Create and download file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'fc_koln_players_' + new Date().toISOString().split('T')[0] + '.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is already logged in
            fetch('/api/auth/check')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.user) {
                        currentUser = data.user;
                        document.getElementById('userName').textContent = currentUser.name;
                        document.getElementById('authContainer').style.display = 'none';
                        document.getElementById('mainApp').style.display = 'block';
                        
                        // Load initial data
                        loadDashboardData();
                        loadPlayers();
                    }
                })
                .catch(error => {
                    console.error('Auth check error:', error);
                });
        });
        
        function showForgotPassword() {
            showInfoMessage('Password reset functionality will be implemented in a future update.');
        }
    </script>
</body>
</html>